#!/bin/bash

luafiles=$(git status --porcelain | awk '/\.lua$/ {print $2}')
cxxfiles=$(git status --porcelain | awk '/\.(cpp|h|c|hpp|cc)$/ {print $2}')

if [ -z "$luafiles" ] && [ -z "$cxxfiles" ]; then
    exit 0
fi

# Â§ÑÁêÜLuaÊñá‰ª∂
if [ -n "$luafiles" ]; then
    while read -r file; do
        [ ! -f "$file" ] && continue
        echo "üîß Formatting Lua: $file"
        Tools/GitHook/stylua --verify "$file"
        if ! Tools/GitHook/luacheck --codes --formatter=default "$file"; then
            echo "‚ùå Lua check failed"
            exit 1
        fi
    done <<<"$luafiles"
fi

# Â§ÑÁêÜC++/Â§¥Êñá‰ª∂ÔºàÂêàÂπ∂Â§ÑÁêÜÔºâ
if [ -n "$cxxfiles" ]; then
    while read -r file; do
        [ ! -f "$file" ] && continue
        echo "üîß Formatting C++: $file"
        Tools/GitHook/clang-format --assume-filename=.clang-format -i "$file"
    done <<<"$cxxfiles"
fi
